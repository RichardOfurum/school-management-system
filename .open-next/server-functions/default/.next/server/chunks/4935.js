"use strict";exports.id=4935,exports.ids=[4935],exports.modules={76224:(e,s,t)=>{t.d(s,{Z:()=>r});var a=t(10326);let r=({label:e,type:s="text",register:t,name:r,defaultValue:i,error:n,hidden:d,inputProps:o})=>(0,a.jsxs)("div",{className:d?"hidden":"flex flex-col gap-1 w-full",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:e}),a.jsx("input",{type:s,...t(r),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",...o,defaultValue:i}),n?.message&&a.jsx("p",{className:"text-xs text-red-500 mt-1",children:n.message.toString()})]})},14935:(e,s,t)=>{t.r(s),t.d(s,{default:()=>p});var a=t(10326),r=t(74064),i=t(17577),n=t(74723),d=t(76224),o=t(8570),m=t(3682),c=t(60962),l=t(11439),u=t(35047),g=t(96980);let p=({type:e,data:s,setOpen:t,relatedData:p,userId:z})=>{let[b,x]=(0,i.useState)(!1),[h,f]=(0,i.useState)(!1),[j,q]=(0,i.useState)([]),[I,y]=(0,i.useState)([]),{user:w}=(0,g.aF)(),T=w?.publicMetadata.role,{register:N,handleSubmit:A,formState:{errors:v}}=(0,n.cI)({resolver:(0,r.F)(o.ON)}),[S,P]=(0,c.useFormState)("create"===e?m.aA:m.sI,{success:!1,error:!1}),D=A(e=>{x(!0);let s=new Date(e.startTime).toLocaleDateString("en-US",{weekday:"long"}).toUpperCase(),t={...e,day:s,teacherId:"teacher"===T?w?.id:e.teacherId};console.log(t),P(t)}),E=(0,u.useRouter)();(0,i.useEffect)(()=>{S.success&&(l.Am.success(`Lesson has been ${"create"===e?"created":"updated"}!`),E.refresh(),t(!1)),S.error&&(x(!1),l.Am.error(S.error))},[S,E,e,t]);let{subjects:L,classes:F,teachers:C}=p,U=async()=>{try{if(!h){let e=await (0,m.A8)(s.id),t=await (0,m.T9)(s.id),a=e.map(e=>{let s=t.find(s=>s.studentId===e.id);return{studentId:e.id,present:!!s&&s.present}});q(e),y(a)}f(!h)}catch(e){console.error("Error fetching students or attendance:",e),l.Am.error("Failed to fetch students or attendance records.")}},V=(e,s)=>{y(t=>t.map(t=>t.studentId===e?{...t,present:s}:t))},Z=async()=>{try{await (0,m.aX)(s.id,I),l.Am.success("Attendance records saved successfully!")}catch(e){console.error("Error saving attendance records:",e),l.Am.error("Failed to save attendance records.")}};return(0,a.jsxs)("form",{className:"flex flex-col gap-8 overflow-auto max-h-[600px] h-auto scrollbar-thin",onSubmit:D,children:[a.jsx("h1",{className:"text-xl font-semibold",children:"create"===e?"Create a new lesson":"Update the lesson"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(d.Z,{label:"Lesson name",name:"name",defaultValue:s?.name,register:N,error:v?.name}),a.jsx(d.Z,{label:"Start Time",name:"startTime",type:"datetime-local",defaultValue:s?.startTime,register:N,error:v?.startTime}),a.jsx(d.Z,{label:"End Time",name:"endTime",type:"datetime-local",defaultValue:s?.endTime,register:N,error:v?.endTime}),s&&a.jsx(d.Z,{label:"Id",name:"id",defaultValue:s?.id,register:N,error:v?.id,hidden:!0})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[a.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Subject"}),a.jsx("select",{...N("subjectId"),className:"border border-gray-300 rounded-md p-2",defaultValue:s?.subjectId,children:L.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))}),v.subjectId?.message&&a.jsx("p",{className:"text-xs text-red-400",children:v.subjectId.message.toString()})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[a.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Class"}),a.jsx("select",{...N("classId"),className:"border border-gray-300 rounded-md p-2",defaultValue:s?.classId,children:F.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))}),v.classId?.message&&a.jsx("p",{className:"text-xs text-red-400",children:v.classId.message.toString()})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:["admin"===T?(0,a.jsxs)(a.Fragment,{children:[a.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Teacher"}),a.jsx("select",{...N("teacherId"),className:"border border-gray-300 rounded-md p-2",defaultValue:s?.teacherId,children:C.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," ",e.surname]},e.id))})]}):a.jsx("input",{type:"text",...N("teacherId"),defaultValue:z,hidden:!0}),v.teacherId?.message&&a.jsx("p",{className:"text-xs text-red-400",children:v.teacherId.message.toString()})]}),"update"===e&&(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[a.jsx("p",{className:" text-black p-2 font-semibold cursor-pointer",onClick:U,children:h?"Hide Attendance":"Enter Attendance"}),h&&(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[j.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-4 justify-between bg-gray-50 p-4 rounded-md",children:[(0,a.jsxs)("span",{children:[e.name," ",e.surname]}),a.jsx("input",{type:"checkbox",checked:I.find(s=>s.studentId===e.id)?.present||!1,onChange:s=>V(e.id,s.target.checked)})]},e.id)),a.jsx("button",{type:"button",className:"bg-green-600 text-white p-2 rounded-md",onClick:Z,children:"Save Attendance"})]})]}),S.error&&a.jsx("span",{className:"text-red-500",children:"Something went wrong!"}),a.jsx("button",{type:"submit",className:"bg-blue-600 text-white p-2 rounded-md disabled:opacity-50",disabled:b,children:b?"Loading...":"create"===e?"Create":"Update"})]})}},8570:(e,s,t)=>{t.d(s,{O7:()=>b,ON:()=>l,Q1:()=>d,Qu:()=>o,Rj:()=>x,UQ:()=>i,Xj:()=>m,a2:()=>u,aD:()=>h,iQ:()=>n,k:()=>z,o6:()=>p,qJ:()=>r,rA:()=>c,zi:()=>g});var a=t(27256);let r=a.z.object({id:a.z.coerce.number().optional(),name:a.z.string().min(1,{message:"Subject name is required!"}),teachers:a.z.array(a.z.string())}),i=a.z.object({id:a.z.coerce.number().optional(),name:a.z.string().min(1,{message:"Subject name is required!"}),capacity:a.z.coerce.number().min(1,{message:"Capacity name is required!"}),gradeId:a.z.coerce.number().min(1,{message:"Grade name is required!"}),supervisorId:a.z.coerce.string().optional()}),n=a.z.object({id:a.z.string().optional(),username:a.z.string().min(10,{message:"Username must be at least 10 characters long!"}),password:a.z.string().min(8,{message:"Password must be at least 8 characters long!"}).refine(e=>/[A-Z]/.test(e),"Password must contain at least one capital letter!").refine(e=>/[0-9]/.test(e),"Password must contain at least one number!").refine(e=>/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(e),"Password must contain at least one special character!").optional().or(a.z.literal("")),name:a.z.string().min(1,{message:"First name is required!"}),surname:a.z.string().min(1,{message:"Last name is required!"}),email:a.z.string().email({message:"Invalid email address!"}).optional().or(a.z.literal("")),phone:a.z.string().optional(),address:a.z.string(),img:a.z.string().optional(),bloodType:a.z.string().min(1,{message:"Blood Type is required!"}),birthday:a.z.coerce.date({message:"Birthday is required!"}),sex:a.z.enum(["MALE","FEMALE"],{message:"Sex is required!"}),subjects:a.z.array(a.z.string()).optional()}),d=a.z.object({id:a.z.string().optional(),username:a.z.string().min(10,{message:"Username must be at least 10 characters long!"}),password:a.z.string().min(8,{message:"Password must be at least 8 characters long!"}).refine(e=>/[A-Z]/.test(e),"Password must contain at least one capital letter!").refine(e=>/[0-9]/.test(e),"Password must contain at least one number!").refine(e=>/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(e),"Password must contain at least one special character!").optional().or(a.z.literal("")),name:a.z.string().min(1,{message:"First name is required!"}),surname:a.z.string().min(1,{message:"Last name is required!"}),email:a.z.string().email({message:"Invalid email address!"}).optional().or(a.z.literal("")),phone:a.z.string().optional(),address:a.z.string(),img:a.z.string().optional(),bloodType:a.z.string().min(1,{message:"Blood Type is required!"}),birthday:a.z.coerce.date({message:"Birthday is required!"}),sex:a.z.enum(["MALE","FEMALE"],{message:"Sex is required!"}),gradeId:a.z.coerce.number().min(1,{message:"Grade is required!"}),classId:a.z.coerce.number().min(1,{message:"Class is required!"}),parentId:a.z.string().min(1,{message:"Parent Id is required!"})}),o=a.z.object({id:a.z.coerce.number().optional(),title:a.z.string().min(1,{message:"Title name is required!"}),startTime:a.z.coerce.date({message:"Start time is required!"}),endTime:a.z.coerce.date({message:"End time is required!"}),lessonId:a.z.coerce.number({message:"Lesson is required!"})}),m=a.z.object({id:a.z.string().optional(),username:a.z.string().min(10,{message:"Username must be at least 10 characters long!"}),password:a.z.string().min(8,{message:"Password must be at least 8 characters long!"}).refine(e=>/[A-Z]/.test(e),"Password must contain at least one capital letter!").refine(e=>/[0-9]/.test(e),"Password must contain at least one number!").refine(e=>/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(e),"Password must contain at least one special character!").optional().or(a.z.literal("")),name:a.z.string().min(1,{message:"First name is required!"}),surname:a.z.string().min(1,{message:"Last name is required!"}),email:a.z.string().email({message:"Invalid email address!"}).optional().or(a.z.literal("")),phone:a.z.string().min(10,{message:"Phone number must be at least 10 digits long!"}).max(15,{message:"Phone number must be at most 15 digits long!"}),address:a.z.string().min(1,{message:"Address is required!"})}),c=a.z.object({id:a.z.coerce.number().optional(),title:a.z.string().min(1,{message:"Title is required!"}),description:a.z.string().min(1,{message:"Description is required!"}),startTime:a.z.coerce.date({message:"Start time is required!"}),endTime:a.z.coerce.date({message:"End time is required!"}),classId:a.z.coerce.number().optional()}).refine(e=>e.endTime>e.startTime,{message:"End time must be after start time!",path:["endTime"]}),l=a.z.object({id:a.z.coerce.number().optional(),name:a.z.string().min(1,{message:"Lesson name is required!"}),day:a.z.string().optional(),startTime:a.z.coerce.date({message:"Start time is required!"}),endTime:a.z.coerce.date({message:"End time is required!"}),subjectId:a.z.coerce.number().min(1,{message:"Subject ID is required!"}),classId:a.z.coerce.number().min(1,{message:"Class ID is required!"}),teacherId:a.z.string().optional()}).refine(e=>e.endTime>e.startTime,{message:"End time must be after start time!",path:["endTime"]}),u=a.z.object({id:a.z.string().optional(),username:a.z.string().min(1,{message:"Username is required!"}).max(50,{message:"Username must be at most 50 characters long!"}),firstName:a.z.string().min(1,{message:"First name is required!"}),surname:a.z.string().min(1,{message:"Last name is required!"}),password:a.z.string().min(8,{message:"Password must be at least 8 characters long!"}).refine(e=>/[A-Z]/.test(e),"Password must contain at least one capital letter!").refine(e=>/[0-9]/.test(e),"Password must contain at least one number!").refine(e=>/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(e),"Password must contain at least one special character!").optional().or(a.z.literal(""))}),g=a.z.object({id:a.z.coerce.number().optional(),title:a.z.string().min(1,{message:"Title is required!"}),description:a.z.string().min(1,{message:"Description is required!"}),date:a.z.coerce.date({message:"Date is required!"}),classId:a.z.coerce.number().optional()}),p=a.z.object({id:a.z.coerce.number().optional(),level:a.z.coerce.number().min(1,{message:"Grade level is required!"}).refine(e=>Number.isInteger(e),{message:"Grade level must be an integer!"}),createdAt:a.z.coerce.date().optional(),updatedAt:a.z.coerce.date().optional()}),z=a.z.object({id:a.z.coerce.number().optional(),title:a.z.string().min(1,{message:"Title is required!"}),startDate:a.z.coerce.date({message:"Start date is required!"}),dueDate:a.z.coerce.date({message:"Due date is required!"}),lessonId:a.z.coerce.number().min(1,{message:"Lesson ID is required!"}),createdAt:a.z.coerce.date().optional(),updatedAt:a.z.coerce.date().optional()}).refine(e=>e.dueDate>e.startDate,{message:"Due date must be after start date!",path:["dueDate"]}),b=a.z.object({id:a.z.coerce.number().optional(),score:a.z.coerce.number().min(0,{message:"Score must be a non-negative number!"}),examId:a.z.coerce.number().optional(),assignmentId:a.z.coerce.number().optional(),studentId:a.z.string().min(1,{message:"Student ID is required!"}),createdAt:a.z.coerce.date().optional(),updatedAt:a.z.coerce.date().optional()}),x=a.z.object({id:a.z.coerce.number().optional(),title:a.z.string().min(1,{message:"Post Title required!"}),description:a.z.string().min(1,{message:"Post description required!"}),image:a.z.string().optional(),createdAt:a.z.coerce.date().optional(),updatedAt:a.z.coerce.date().optional()}),h=a.z.object({id:a.z.coerce.number().optional(),title:a.z.string().min(1,{message:"Title required!"}).max(100,{message:"Title must be less than 100 characters!"}),file:a.z.string().optional()})}};