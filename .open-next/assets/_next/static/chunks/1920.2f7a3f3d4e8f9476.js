(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1920],{20357:function(e,t,r){"use strict";var s,a;e.exports=(null==(s=r.g.process)?void 0:s.env)&&"object"==typeof(null==(a=r.g.process)?void 0:a.env)?r.g.process:r(88081)},88081:function(e){!function(){var t={229:function(e){var t,r,s,a=e.exports={};function n(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===n||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:n}catch(e){t=n}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var d=[],c=!1,l=-1;function m(){c&&s&&(c=!1,s.length?d=s.concat(d):l=-1,d.length&&u())}function u(){if(!c){var e=o(m);c=!0;for(var t=d.length;t;){for(s=d,d=[];++l<t;)s&&s[l].run();l=-1,t=d.length}s=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function p(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new g(e,t)),1!==d.length||c||o(u)},g.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=p,a.addListener=p,a.once=p,a.off=p,a.removeListener=p,a.removeAllListeners=p,a.emit=p,a.prependListener=p,a.prependOnceListener=p,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},r={};function s(e){var a=r[e];if(void 0!==a)return a.exports;var n=r[e]={exports:{}},i=!0;try{t[e](n,n.exports,s),i=!1}finally{i&&delete r[e]}return n.exports}s.ab="//";var a=s(229);e.exports=a}()},38113:function(e,t,r){"use strict";var s=r(57437);t.Z=e=>{let{label:t,type:r="text",register:a,name:n,defaultValue:i,error:o,hidden:d,inputProps:c}=e;return(0,s.jsxs)("div",{className:d?"hidden":"flex flex-col gap-1 w-full",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700",children:t}),(0,s.jsx)("input",{type:r,...a(n),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",...c,defaultValue:i}),(null==o?void 0:o.message)&&(0,s.jsx)("p",{className:"text-xs text-red-500 mt-1",children:o.message.toString()})]})}},41245:function(e,t,r){"use strict";r.r(t);var s=r(57437),a=r(31014),n=r(2265),i=r(39343),o=r(38113),d=r(80118),c=r(31721),l=r(54887),m=r(24648),u=r(16463),g=r(5267);t.default=e=>{var t,r,p;let{type:f,data:b,setOpen:z,relatedData:h,userId:x}=e,[v,j]=(0,n.useState)(!1),[y,T]=(0,n.useState)(!1),[q,I]=(0,n.useState)([]),[w,N]=(0,n.useState)([]),{user:A}=(0,g.aF)(),S=null==A?void 0:A.publicMetadata.role,{register:E,handleSubmit:P,formState:{errors:L}}=(0,i.cI)({resolver:(0,a.F)(d.ON)}),[D,k]=(0,l.useFormState)("create"===f?c.aA:c.sI,{success:!1,error:!1}),C=P(e=>{j(!0);let t=new Date(e.startTime).toLocaleDateString("en-US",{weekday:"long"}).toUpperCase(),r={...e,day:t,teacherId:"teacher"===S?null==A?void 0:A.id:e.teacherId};console.log(r),k(r)}),F=(0,u.useRouter)();(0,n.useEffect)(()=>{D.success&&(m.Am.success("Lesson has been ".concat("create"===f?"created":"updated","!")),F.refresh(),z(!1)),D.error&&(j(!1),m.Am.error(D.error))},[D,F,f,z]);let{subjects:U,classes:V,teachers:Z}=h,_=async()=>{try{if(!y){let e=await (0,c.A8)(b.id),t=await (0,c.T9)(b.id),r=e.map(e=>{let r=t.find(t=>t.studentId===e.id);return{studentId:e.id,present:!!r&&r.present}});I(e),N(r)}T(!y)}catch(e){console.error("Error fetching students or attendance:",e),m.Am.error("Failed to fetch students or attendance records.")}},M=(e,t)=>{N(r=>r.map(r=>r.studentId===e?{...r,present:t}:r))},B=async()=>{try{await (0,c.aX)(b.id,w),m.Am.success("Attendance records saved successfully!")}catch(e){console.error("Error saving attendance records:",e),m.Am.error("Failed to save attendance records.")}};return(0,s.jsxs)("form",{className:"flex flex-col gap-8 overflow-auto max-h-[600px] h-auto scrollbar-thin",onSubmit:C,children:[(0,s.jsx)("h1",{className:"text-xl font-semibold",children:"create"===f?"Create a new lesson":"Update the lesson"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(o.Z,{label:"Lesson name",name:"name",defaultValue:null==b?void 0:b.name,register:E,error:null==L?void 0:L.name}),(0,s.jsx)(o.Z,{label:"Start Time",name:"startTime",type:"datetime-local",defaultValue:null==b?void 0:b.startTime,register:E,error:null==L?void 0:L.startTime}),(0,s.jsx)(o.Z,{label:"End Time",name:"endTime",type:"datetime-local",defaultValue:null==b?void 0:b.endTime,register:E,error:null==L?void 0:L.endTime}),b&&(0,s.jsx)(o.Z,{label:"Id",name:"id",defaultValue:null==b?void 0:b.id,register:E,error:null==L?void 0:L.id,hidden:!0})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-xs font-medium text-gray-600",children:"Subject"}),(0,s.jsx)("select",{...E("subjectId"),className:"border border-gray-300 rounded-md p-2",defaultValue:null==b?void 0:b.subjectId,children:U.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))}),(null===(t=L.subjectId)||void 0===t?void 0:t.message)&&(0,s.jsx)("p",{className:"text-xs text-red-400",children:L.subjectId.message.toString()})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-xs font-medium text-gray-600",children:"Class"}),(0,s.jsx)("select",{...E("classId"),className:"border border-gray-300 rounded-md p-2",defaultValue:null==b?void 0:b.classId,children:V.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))}),(null===(r=L.classId)||void 0===r?void 0:r.message)&&(0,s.jsx)("p",{className:"text-xs text-red-400",children:L.classId.message.toString()})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:["admin"===S?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("label",{className:"text-xs font-medium text-gray-600",children:"Teacher"}),(0,s.jsx)("select",{...E("teacherId"),className:"border border-gray-300 rounded-md p-2",defaultValue:null==b?void 0:b.teacherId,children:Z.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," ",e.surname]},e.id))})]}):(0,s.jsx)("input",{type:"text",...E("teacherId"),defaultValue:x,hidden:!0}),(null===(p=L.teacherId)||void 0===p?void 0:p.message)&&(0,s.jsx)("p",{className:"text-xs text-red-400",children:L.teacherId.message.toString()})]}),"update"===f&&(0,s.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,s.jsx)("p",{className:" text-black p-2 font-semibold cursor-pointer",onClick:_,children:y?"Hide Attendance":"Enter Attendance"}),y&&(0,s.jsxs)("div",{className:"flex flex-col gap-4",children:[q.map(e=>{var t;return(0,s.jsxs)("div",{className:"flex items-center gap-4 justify-between bg-gray-50 p-4 rounded-md",children:[(0,s.jsxs)("span",{children:[e.name," ",e.surname]}),(0,s.jsx)("input",{type:"checkbox",checked:(null===(t=w.find(t=>t.studentId===e.id))||void 0===t?void 0:t.present)||!1,onChange:t=>M(e.id,t.target.checked)})]},e.id)}),(0,s.jsx)("button",{type:"button",className:"bg-green-600 text-white p-2 rounded-md",onClick:B,children:"Save Attendance"})]})]}),D.error&&(0,s.jsx)("span",{className:"text-red-500",children:"Something went wrong!"}),(0,s.jsx)("button",{type:"submit",className:"bg-blue-600 text-white p-2 rounded-md disabled:opacity-50",disabled:v,children:v?"Loading...":"create"===f?"Create":"Update"})]})}},80118:function(e,t,r){"use strict";r.d(t,{O7:function(){return b},ON:function(){return m},Q1:function(){return o},Qu:function(){return d},Rj:function(){return z},UQ:function(){return n},Xj:function(){return c},a2:function(){return u},aD:function(){return h},iQ:function(){return i},k:function(){return f},o6:function(){return p},qJ:function(){return a},rA:function(){return l},zi:function(){return g}});var s=r(59772);let a=s.z.object({id:s.z.coerce.number().optional(),name:s.z.string().min(1,{message:"Subject name is required!"}),teachers:s.z.array(s.z.string())}),n=s.z.object({id:s.z.coerce.number().optional(),name:s.z.string().min(1,{message:"Subject name is required!"}),capacity:s.z.coerce.number().min(1,{message:"Capacity name is required!"}),gradeId:s.z.coerce.number().min(1,{message:"Grade name is required!"}),supervisorId:s.z.coerce.string().optional()}),i=s.z.object({id:s.z.string().optional(),username:s.z.string().min(10,{message:"Username must be at least 10 characters long!"}),password:s.z.string().min(8,{message:"Password must be at least 8 characters long!"}).refine(e=>/[A-Z]/.test(e),"Password must contain at least one capital letter!").refine(e=>/[0-9]/.test(e),"Password must contain at least one number!").refine(e=>/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(e),"Password must contain at least one special character!").optional().or(s.z.literal("")),name:s.z.string().min(1,{message:"First name is required!"}),surname:s.z.string().min(1,{message:"Last name is required!"}),email:s.z.string().email({message:"Invalid email address!"}).optional().or(s.z.literal("")),phone:s.z.string().optional(),address:s.z.string(),img:s.z.string().optional(),bloodType:s.z.string().min(1,{message:"Blood Type is required!"}),birthday:s.z.coerce.date({message:"Birthday is required!"}),sex:s.z.enum(["MALE","FEMALE"],{message:"Sex is required!"}),subjects:s.z.array(s.z.string()).optional()}),o=s.z.object({id:s.z.string().optional(),username:s.z.string().min(10,{message:"Username must be at least 10 characters long!"}),password:s.z.string().min(8,{message:"Password must be at least 8 characters long!"}).refine(e=>/[A-Z]/.test(e),"Password must contain at least one capital letter!").refine(e=>/[0-9]/.test(e),"Password must contain at least one number!").refine(e=>/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(e),"Password must contain at least one special character!").optional().or(s.z.literal("")),name:s.z.string().min(1,{message:"First name is required!"}),surname:s.z.string().min(1,{message:"Last name is required!"}),email:s.z.string().email({message:"Invalid email address!"}).optional().or(s.z.literal("")),phone:s.z.string().optional(),address:s.z.string(),img:s.z.string().optional(),bloodType:s.z.string().min(1,{message:"Blood Type is required!"}),birthday:s.z.coerce.date({message:"Birthday is required!"}),sex:s.z.enum(["MALE","FEMALE"],{message:"Sex is required!"}),gradeId:s.z.coerce.number().min(1,{message:"Grade is required!"}),classId:s.z.coerce.number().min(1,{message:"Class is required!"}),parentId:s.z.string().min(1,{message:"Parent Id is required!"})}),d=s.z.object({id:s.z.coerce.number().optional(),title:s.z.string().min(1,{message:"Title name is required!"}),startTime:s.z.coerce.date({message:"Start time is required!"}),endTime:s.z.coerce.date({message:"End time is required!"}),lessonId:s.z.coerce.number({message:"Lesson is required!"})}),c=s.z.object({id:s.z.string().optional(),username:s.z.string().min(10,{message:"Username must be at least 10 characters long!"}),password:s.z.string().min(8,{message:"Password must be at least 8 characters long!"}).refine(e=>/[A-Z]/.test(e),"Password must contain at least one capital letter!").refine(e=>/[0-9]/.test(e),"Password must contain at least one number!").refine(e=>/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(e),"Password must contain at least one special character!").optional().or(s.z.literal("")),name:s.z.string().min(1,{message:"First name is required!"}),surname:s.z.string().min(1,{message:"Last name is required!"}),email:s.z.string().email({message:"Invalid email address!"}).optional().or(s.z.literal("")),phone:s.z.string().min(10,{message:"Phone number must be at least 10 digits long!"}).max(15,{message:"Phone number must be at most 15 digits long!"}),address:s.z.string().min(1,{message:"Address is required!"})}),l=s.z.object({id:s.z.coerce.number().optional(),title:s.z.string().min(1,{message:"Title is required!"}),description:s.z.string().min(1,{message:"Description is required!"}),startTime:s.z.coerce.date({message:"Start time is required!"}),endTime:s.z.coerce.date({message:"End time is required!"}),classId:s.z.coerce.number().optional()}).refine(e=>e.endTime>e.startTime,{message:"End time must be after start time!",path:["endTime"]}),m=s.z.object({id:s.z.coerce.number().optional(),name:s.z.string().min(1,{message:"Lesson name is required!"}),day:s.z.string().optional(),startTime:s.z.coerce.date({message:"Start time is required!"}),endTime:s.z.coerce.date({message:"End time is required!"}),subjectId:s.z.coerce.number().min(1,{message:"Subject ID is required!"}),classId:s.z.coerce.number().min(1,{message:"Class ID is required!"}),teacherId:s.z.string().optional()}).refine(e=>e.endTime>e.startTime,{message:"End time must be after start time!",path:["endTime"]}),u=s.z.object({id:s.z.string().optional(),username:s.z.string().min(1,{message:"Username is required!"}).max(50,{message:"Username must be at most 50 characters long!"}),firstName:s.z.string().min(1,{message:"First name is required!"}),surname:s.z.string().min(1,{message:"Last name is required!"}),password:s.z.string().min(8,{message:"Password must be at least 8 characters long!"}).refine(e=>/[A-Z]/.test(e),"Password must contain at least one capital letter!").refine(e=>/[0-9]/.test(e),"Password must contain at least one number!").refine(e=>/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(e),"Password must contain at least one special character!").optional().or(s.z.literal(""))}),g=s.z.object({id:s.z.coerce.number().optional(),title:s.z.string().min(1,{message:"Title is required!"}),description:s.z.string().min(1,{message:"Description is required!"}),date:s.z.coerce.date({message:"Date is required!"}),classId:s.z.coerce.number().optional()}),p=s.z.object({id:s.z.coerce.number().optional(),level:s.z.coerce.number().min(1,{message:"Grade level is required!"}).refine(e=>Number.isInteger(e),{message:"Grade level must be an integer!"}),createdAt:s.z.coerce.date().optional(),updatedAt:s.z.coerce.date().optional()}),f=s.z.object({id:s.z.coerce.number().optional(),title:s.z.string().min(1,{message:"Title is required!"}),startDate:s.z.coerce.date({message:"Start date is required!"}),dueDate:s.z.coerce.date({message:"Due date is required!"}),lessonId:s.z.coerce.number().min(1,{message:"Lesson ID is required!"}),createdAt:s.z.coerce.date().optional(),updatedAt:s.z.coerce.date().optional()}).refine(e=>e.dueDate>e.startDate,{message:"Due date must be after start date!",path:["dueDate"]}),b=s.z.object({id:s.z.coerce.number().optional(),score:s.z.coerce.number().min(0,{message:"Score must be a non-negative number!"}),examId:s.z.coerce.number().optional(),assignmentId:s.z.coerce.number().optional(),studentId:s.z.string().min(1,{message:"Student ID is required!"}),createdAt:s.z.coerce.date().optional(),updatedAt:s.z.coerce.date().optional()}),z=s.z.object({id:s.z.coerce.number().optional(),title:s.z.string().min(1,{message:"Post Title required!"}),description:s.z.string().min(1,{message:"Post description required!"}),image:s.z.string().optional(),createdAt:s.z.coerce.date().optional(),updatedAt:s.z.coerce.date().optional()}),h=s.z.object({id:s.z.coerce.number().optional(),title:s.z.string().min(1,{message:"Title required!"}).max(100,{message:"Title must be less than 100 characters!"}),file:s.z.string().optional()})}}]);